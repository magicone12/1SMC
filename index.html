<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1SANMATEOCABLE</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>
<style>
html, body { margin:0; height:100%; background:#000; display:flex; flex-direction:column; }
#topBar{ display:flex; align-items:center; justify-content:space-between; padding:12px 16px; background:#0f0f0f; border-bottom:1px solid #222; }
#appName{ color:#fff; font-size:18px; font-weight:700; letter-spacing:1px; }
#menuBtns{ display:flex; gap:10px; }
.menuBtn{ background:#1f1f1f; color:#fff; border:none; padding:8px 14px; border-radius:8px; cursor:pointer; font-size:13px; }
.menuBtn.active{ background:#d00000; }
#mainWrap{ flex:1; display:flex; justify-content:center; align-items:center; }
#channelSelect { display:grid; grid-template-columns:repeat(4, 1fr); gap:20px; justify-items:center; align-items:center; background:#111; padding:20px; border-radius:12px; }
.channelBtn { width:140px; height:140px; border-radius:12px; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 0 10px rgba(255,255,255,.15); transition: transform 0.2s; }
.channelBtn:hover { transform: scale(1.05); }
.channelBtn img { max-width:85%; max-height:85%; border-radius:8px; }
.channelCode { margin-top:6px; color:#fff; font-size:12px; background:rgba(0,0,0,0.4); padding:2px 6px; border-radius:4px; text-align:center; }
#playerContainer { position:fixed; inset:0; display:none; }
video { width:100%; height:100%; object-fit:contain; background:#000; cursor:pointer; }
#liveBadge { position:absolute; top:14px; left:14px; background:#d00000; color:#fff; font-size:12px; padding:6px 10px; border-radius:4px; font-weight:bold; letter-spacing:.5px; display:flex; align-items:center; gap:6px; opacity:0; transition: opacity 0.5s; }
#dot { width:8px; height:8px; background:#fff; border-radius:50%; animation:pulse 1.2s infinite; }
#backBtn { position:absolute; top:14px; right:14px; background:#222; color:#fff; font-size:14px; padding:6px 12px; border-radius:6px; cursor:pointer; opacity:0; transition: opacity 0.5s; z-index:1000; }
@keyframes pulse { 0%{opacity:1} 50%{opacity:.3} 100%{opacity:1} }
</style>
</head>
<body>

<div id="topBar">
  <div id="appName">1SANMATEOCABLE</div>
  <div id="menuBtns">
    <button class="menuBtn active" id="btnIptv">IPTV</button>
    <button class="menuBtn" id="btnMovies">MOVIES</button>
    <button class="menuBtn" id="btnMovies2">MOVIES2</button>
  </div>
</div>

<div id="mainWrap">
<div id="channelSelect">
  <!-- Channels here -->
</div>
</div>

<div id="playerContainer">
  <div id="liveBadge"><span id="dot"></span>LIVE</div>
  <button id="backBtn">BACK</button>
  <video id="video" autoplay playsinline></video>
</div>

<script>
const video = document.getElementById('video');
const playerContainer = document.getElementById('playerContainer');
const backBtn = document.getElementById('backBtn');
const liveBadge = document.getElementById('liveBadge');
let player;
let badgeTimeout;

async function initPlayer(manifest, key) {
  if (player) { player.destroy(); }
  player = new shaka.Player(video);
  if(key){
    const [kid, kvalue] = key.split(':');
    player.configure({ drm: { clearKeys: { [kid]: kvalue } }, streaming: { lowLatencyMode:true, rebufferingGoal:0.5, bufferingGoal:6 } });
  }
  try { await player.load(manifest); } catch(e){ console.error(e); }
  video.muted = false;
}

function showLiveAndBack() {
  liveBadge.style.opacity = 1;
  backBtn.style.opacity = 1;
  clearTimeout(badgeTimeout);
  badgeTimeout = setTimeout(() => {
    liveBadge.style.opacity = 0;
    backBtn.style.opacity = 0;
  }, 3000);
}

document.querySelectorAll('.channelBtn').forEach(btn => {
  btn.addEventListener('click', async ()=>{
    document.getElementById('channelSelect').style.display='none';
    document.getElementById('topBar').style.display='none';
    playerContainer.style.display='block';
    const manifest = btn.dataset.manifest;
    const key = btn.dataset.key;
    await initPlayer(manifest,key);
    try { await video.play(); } catch(e){}
    if(document.fullscreenElement==null && playerContainer.requestFullscreen) playerContainer.requestFullscreen().catch(()=>{});
    video.controls = false;
    showLiveAndBack();
  });
});

video.addEventListener('click', showLiveAndBack);

function goBack(){
  if(document.fullscreenElement) { document.exitFullscreen().catch(()=>{}); }
  playerContainer.style.display='none';
  document.getElementById('channelSelect').style.display='grid';
  document.getElementById('topBar').style.display='flex';
  if(player) player.destroy();
}

backBtn.addEventListener('click', goBack);

// Handle keyboard Back (Esc / Android Back)
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    if(playerContainer.style.display==='block'){ goBack(); }
  }
});

window.addEventListener('popstate', ()=>{
  if(playerContainer.style.display==='block'){ goBack(); }
});

// simple tab highlight only
const tabs = document.querySelectorAll('.menuBtn');
tabs.forEach(b=>{
  b.addEventListener('click',()=>{
    tabs.forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
  });
});
</script>

</body>
</html>
